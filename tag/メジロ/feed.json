{
    "version": "https://jsonfeed.org/version/1",
    "title": "taniho's blog • All posts by \"メジロ\" tag",
    "description": "technical note",
    "home_page_url": "http://blog.taniho.net",
    "items": [
        {
            "id": "http://blog.taniho.net/2017/12/TAC-05-USB%E3%83%8F%E3%83%96%E3%82%92%E8%87%AA%E4%BD%9C%E3%81%97%E3%81%9F%E3%82%8A%E3%81%97%E3%81%A6%E5%B0%82%E7%94%A8%E5%9F%BA%E6%9D%BF%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F/",
            "url": "http://blog.taniho.net/2017/12/TAC-05-USB%E3%83%8F%E3%83%96%E3%82%92%E8%87%AA%E4%BD%9C%E3%81%97%E3%81%9F%E3%82%8A%E3%81%97%E3%81%A6%E5%B0%82%E7%94%A8%E5%9F%BA%E6%9D%BF%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F/",
            "title": "[TAC:05] USBハブを自作したりして専用基板を作った",
            "date_published": "2017-12-04T15:00:00.000Z",
            "content_html": "<h1 id=\"はじめに\"><a href=\"#はじめに\" class=\"headerlink\" title=\"はじめに\"></a>はじめに</h1><p>この記事は<a href=\"http://blog.taniho.net/categories/TAC2017/\">taniho Advent Calendar 2017</a>の5日目の記事です．</p>\n<p>今日は「鵤」専用の書き込み兼充電兼インターフェース基板である「メジロ」を紹介します．載っている書き込み回路と充電回路は，前回と前々回のブログを見てください．今回の記事では，メジロちゃんのインターフェース機能について紹介します．</p>\n<a id=\"more\"></a>\n\n<h1 id=\"メジロちゃん\"><a href=\"#メジロちゃん\" class=\"headerlink\" title=\"メジロちゃん\"></a>メジロちゃん</h1><p>これがメジロちゃんです．</p>\n<p><img src=\"mejiro.jpg\" alt=\"メジロちゃん\"></p>\n<h1 id=\"機能\"><a href=\"#機能\" class=\"headerlink\" title=\"機能\"></a>機能</h1><p>これがメジロちゃんの全機能です．</p>\n<ul>\n<li>マイコン内蔵</li>\n<li>uOLED液晶搭載</li>\n<li>USB-UART変換 x2</li>\n<li>LiPo1セル充電 x3</li>\n<li>鵤の電源制御</li>\n<li>鵤のモード制御</li>\n</ul>\n<h2 id=\"2つのマイコンを使う\"><a href=\"#2つのマイコンを使う\" class=\"headerlink\" title=\"2つのマイコンを使う\"></a>2つのマイコンを使う</h2><p>メジロちゃんと鵤くんをつなげた状態でパソコンに接続すると，USB1ポートにマイコンが2個繋がった状態になっています．</p>\n<p><img src=\"usb.png\" alt=\"つながる頭\"></p>\n<p>そして，メジロちゃんと鵤くんと同時に通信をしたいということがあり，頭の悪い僕はUSBハブを内蔵させてしまいました．</p>\n<p><a href=\"http://www.microchip.com/wwwproducts/en/USB2422\">USB2422 - USB - USB Hubs</a></p>\n<p>メジロちゃんを接続すると，パソコンから2つのポートとして認識されます．このおかげで，「メジロちゃんから鵤くん電源ON→鵤くん書き込み→鵤くん電源OFF」という一連の作業を楽に行えるようになりました．</p>\n<h2 id=\"電源制御・モード制御\"><a href=\"#電源制御・モード制御\" class=\"headerlink\" title=\"電源制御・モード制御\"></a>電源制御・モード制御</h2><p>メジロちゃんに載っているマイコンが，鵤くんの電源用FETのゲート端子に接続されています．回路図はこんな感じです．</p>\n<p><img src=\"1.png\" alt=\"メジロちゃん側のコネクタ周辺\"></p>\n<p><img src=\"2.png\" alt=\"鵤くん側のコネクタ周辺\"></p>\n<p>メジロちゃんをパソコンに接続し，シリアルでメジロちゃんに信号を送ることで，鵤くんの電源をON/OFFすることが出来ます．</p>\n<p>鵤くんのモード制御も同様に，メジロちゃんから書き込みモードと実行モードを変更できるようにしています．</p>\n<p>鵤くん書き込みのコマンドはこんな感じです．アルファベット1文字をメジロちゃんへの命令にして，鵤くんを制御しています．</p>\n<ul>\n<li>d: Power Off</li>\n<li>u: Power On</li>\n<li>w: Write Mode</li>\n<li>r: Run Mode</li>\n</ul>\n<figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo d &gt; /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO01-if00-port0</span><br><span class=\"line\">echo w &gt; /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO01-if00-port0</span><br><span class=\"line\">sleep 0.1</span><br><span class=\"line\">echo u &gt; /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO01-if00-port0</span><br><span class=\"line\">sleep 0.3</span><br><span class=\"line\">stm32flash -b 230400 -w build/Ikaru.hex /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO02-if00-port0 -e 80</span><br><span class=\"line\">echo d &gt; /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO01-if00-port0</span><br><span class=\"line\">echo r &gt; /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_MEJIRO01-if00-port0</span><br></pre></td></tr></table></figure>\n\n<p>実際の使い勝手は最高です．次のコマンドを打つだけで，鵤くんの電源をONにして書き込み，電源をOFFにしてくれます．</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make flash</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"uOLED液晶\"><a href=\"#uOLED液晶\" class=\"headerlink\" title=\"uOLED液晶\"></a>uOLED液晶</h2><p>昔使用したuOLEDをメジロちゃんに転用しました．</p>\n<p><a href=\"http://www.4dsystems.com.au/product/uOLED_96_G2/\">4D Systems | uOLED-96-G2</a></p>\n<p>このuOLED，少し高いですが使い勝手が良いのでおすすめです．(ただしマウスに載せると壊れる可能性があるのでやめましょう)</p>\n<p>鵤くんのLiPoから電源を供給して，uOLEDが動くようにしています．しかし，鵤くんのLiPoの容量が50mAhしか無いので，未だに使っていません．次回作では活用しようと思います．</p>\n<h1 id=\"まとめ\"><a href=\"#まとめ\" class=\"headerlink\" title=\"まとめ\"></a>まとめ</h1><p>ということで，鵤くんのサポートをするメジロくんの話でした．</p>\n<p>明日からの<a href=\"http://blog.taniho.net/categories/TAC2017/\">taniho Advent Calendar 2017</a>はマイクロマウスから離れ，今年製作した作品(？)の紹介を何回かに分けてしようと思っています．</p>\n",
            "tags": [
                "メジロ"
            ]
        }
    ]
}